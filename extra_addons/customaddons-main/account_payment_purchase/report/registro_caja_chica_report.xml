<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <record id="report_caja_chica_paperformat" model="report.paperformat">
            <field name="name">Caja Chica</field>
            <field name="default" eval="False"/>
            <field name="format">A4</field>
            <field name="margin_top">15</field>
            <field name="margin_bottom">15</field>
            <field name="margin_left">10</field>
            <field name="margin_right">10</field>
            <field name="orientation">Landscape</field>
            <field name="header_spacing">5</field>
        </record>

        <!-- Definición del Reporte -->
        <record id="registro_cajachica_rep" model="ir.actions.report">
            <field name="name">Registro Caja Chica</field>
            <field name="model">hr.registro.caja.chica</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">account_payment_purchase.report_registro_caja_chica</field>
            <field name="report_file">account_payment_purchase.report_registro_caja_chica</field>
            <field name="paperformat_id" ref="report_caja_chica_paperformat"/>
        </record>

        <!-- Plantilla del Reporte -->
        <template id="report_registro_caja_chica">
            <t t-call="web.basic_layout">
                <t t-foreach="docs" t-as="o">
                    <div class="page">
                        <!-- Encabezado -->
                        <div style="text-align: center; margin-bottom: 20px;">
                            <h3>CAJA CHICA <span t-esc="o.name"/></h3>
                        </div>
                        <table style="width: 100%; margin-bottom: 20px;">
                            <tr>
                                <td style="width: 50%;"><strong>Tipo de Reposición:</strong> <span>CAJA CHICA</span></td>
                                <td style="width: 50%;"><strong>Fondo Asignado:</strong> <span t-esc="o.employee_id.company_id.name"/></td>
                            </tr>
                            <tr>
                                <td><strong>Fecha de Reposición:</strong> <span t-esc="o.fechaingreso"/></td>
                                <td><strong>Custodio del Empleado:</strong>  <span t-esc="o.employee_id.name"/></td>
                            </tr>
                            <tr>
                                <t t-if="o.job_id and o.job_id.name">
    <td><strong>Cargo:</strong> <span t-esc="o.job_id.name"/></td>
</t>
                                <td colspan="2"><strong>Valor Asignado:</strong> </td>
                            </tr>
                        </table>

                        <!-- Tabla de Detalle -->
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;" border="1">
                            <thead>
                                <tr style="background-color: #f0f0f0; text-align: center;">
                                    <th>Fecha</th>
                                    <th>Tipo</th>
                                    <th>Número</th>
                                    <th>RUC</th>
                                    <th>Proveedor</th>
                                    <th>Detalle</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-if="o.state in ('draft', 'revision')">
                                    <t t-foreach="o.line_ids" t-as="line">
                                        <tr>
                                            <td><span t-esc="line.fecha or 'Sin fecha'"/></td>
                                            <td><span t-esc="line.tipo_documento or 'N/A'"/></td>
                                            <td><span t-esc="line.nro_documento or 'N/A'"/></td>
                                            <td><span t-esc="line.identification_id or 'N/A'"/></td>
                                            <td><span t-esc="line.beneficiario or 'N/A'"/></td>
                                            <td><span t-esc="line.observacion or 'N/A'"/></td>
                                            <td style="text-align: right;"><span t-esc="line.valor or 0.0"/></td>
                                        </tr>
                                    </t>
                                </t>
                                <t t-if="o.state in ('to_approve', 'approve')">
                                    <t t-foreach="o.line_ids.filtered(lambda l: l.verificado)" t-as="line">
                                        <tr>
                                            <td><span t-esc="line.fecha or 'Sin fecha'"/></td>
                                            <td><span t-esc="line.tipo_documento or 'N/A'"/></td>
                                            <td><span t-esc="line.nro_documento or 'N/A'"/></td>
                                            <td><span t-esc="line.identification_id or 'N/A'"/></td>
                                            <td><span t-esc="line.beneficiario or 'N/A'"/></td>
                                            <td><span t-esc="line.observacion or 'N/A'"/></td>
                                            <td style="text-align: right;"><span t-esc="line.valor_aprobado or 0.0"/></td>
                                        </tr>
                                    </t>
                                </t>
                            </tbody>
                            <tfoot>
                                <t t-if="o.state in ('draft', 'revision')">
                                    <tr>
                                        <td colspan="6" style="text-align: right;"><strong>TOTAL:</strong></td>
                                        <td style="text-align: right;"><strong t-esc="sum(line.valor for line in o.line_ids)"/></td>
                                    </tr>
                                </t>
                                <t t-if="o.state in ('to_approve', 'approve')">
                                    <tr>
                                        <td colspan="6" style="text-align: right;"><strong>TOTAL:</strong></td>
                                        <td style="text-align: right;"><strong t-esc="sum(line.valor_aprobado for line in o.line_ids.filtered(lambda l: l.verificado))"/></td>
                                    </tr>
                                </t>
                            </tfoot>
                        </table>

                        <div style="margin-top: 20px; font-size: 10px;">
                            <p>* Nota: Los vales de caja no pueden ser mayores a $50.00 y deben de tener firma de su jefe inmediato.</p>
                        </div>

                        <!-- Firmas -->
                        <table style="width: 100%; margin-top: 40px; font-size: 12px;">
                            <tr>
                                <td style="text-align: center; width: 25%; padding: 10px;">
                                    _____________________________<br/>
                                    <strong>FIRMA DEL EMPLEADO</strong><br/>
                                    ELABORADO POR
                                </td>
                                <td style="text-align: center; width: 25%; padding: 10px;">
                                    _____________________________<br/>
                                    <strong>JEFE INMEDIATO O SUPERVISOR</strong><br/>
                                    APROBADO POR
                                </td>
                                <td style="text-align: center; width: 25%; padding: 10px;">
                                    _____________________________<br/>
                                    <strong>ASIGNADO DE CONTABILIDAD</strong><br/>
                                    REVISADO POR
                                </td>
                                <td style="text-align: center; width: 25%; padding: 10px;">
                                    _____________________________<br/>
                                    <strong>JEFE FINANCIERO</strong><br/>
                                    CANCELADO POR
                                </td>
                            </tr>
                        </table>
                    </div>
                </t>
            </t>
        </template>

    </data>
</odoo>
