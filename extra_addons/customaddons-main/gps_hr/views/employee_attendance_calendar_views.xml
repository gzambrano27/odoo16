<odoo>
    <!-- Vista Tree -->
    <record id="view_employee_attendance_calendar_tree" model="ir.ui.view">
        <field name="name">employee.attendance.calendar.tree</field>
        <field name="model">employee.attendance.calendar</field>
        <field name="arch" type="xml">
            <tree string="Asistencia de empleados" create="false" edit="false" delete="false"
                  decoration-danger="estado_entrada == 'atraso' or estado_salida == 'anticipada' or estado_marcacion == 'incompleto'"
                  decoration-success="estado_marcacion != 'incompleto' and estado_entrada != 'atraso' and estado_salida != 'anticipada'"
                  decoration-it="estado_marcacion=='incompleto'">
                <field name="empleado_id" options="{'no_create':True,'no_open':True,'no_edit':True}"/>
                <field name="empleado_nombre" invisible="1" optional="hide"/>
                <field name="day_id" options="{'no_create':True,'no_open':True,'no_edit':True}"/>
                <field name="fecha"/>
                <field name="entrada_real" optional="hide"/>
                <field name="salida_real" optional="hide"/>

                <field name="entrada_hora" widget="float_time"/>
                <field name="salida_hora" widget="float_time"/>

                <field name="inicio" widget="float_time" optional="hide"/>
                <field name="fin" widget="float_time" optional="hide"/>

                <field name="estado_marcacion"/>
                <field name="dif_min_entrada"
                       attrs="{'invisible':['|',('estado_entrada','=','sin_horario'),('dif_min_entrada','&lt;=',0.00)]}"
                       optional="hide"/>
                <field name="estado_entrada" attrs="{'invisible':[('dif_min_entrada','&lt;=',0.00)]}" optional="hide"/>
                <field name="dif_min_salida" attrs="{'invisible':[('dif_min_salida','&lt;=',0.00)]}" optional="hide"/>
                <field name="estado_salida" attrs="{'invisible':[('dif_min_salida','&lt;=',0.00)]}" optional="hide"/>

                <field name="minutos_descontar" attrs="{'invisible':[('minutos_descontar','&lt;=',0.00)]}"/>
                <field name="minutos_extras" attrs="{'invisible':[('minutos_extras','&lt;=',0.00)]}"/>

                <field name="feriado_id" optional="hide" options="{'no_create':True,'no_open':True,'no_edit':True}"/>
            </tree>
        </field>
    </record>

    <!-- Search -->
    <record id="view_employee_attendance_calendar_search" model="ir.ui.view">
        <field name="name">employee.attendance.calendar.search</field>
        <field name="model">employee.attendance.calendar</field>
        <field name="arch" type="xml">
            <search string="Asistencias">
                <field name="empleado_id" string="Empleado"/>
                <field name="fecha" string="Fecha"/>
                <field name="day_id"/>

                <!-- Filtros comunes -->
                <filter string="Atrasos" name="filtro_atrasos" domain="[('estado_entrada','=','atraso')]"/>
                <filter string="Entradas tempranas" name="filtro_temprano"
                        domain="[('estado_entrada','=','temprano')]"/>
                <filter string="Salidas anticipadas" name="filtro_anticipada"
                        domain="[('estado_salida','=','anticipada')]"/>
                <filter string="Salidas tardías" name="filtro_tardia" domain="[('estado_salida','=','tardia')]"/>
                <filter string="Incompletos" name="filtro_incompletos"
                        domain="[('estado_marcacion','=','incompleto')]"/>
                <filter string="Faltas" name="filtro_faltas"
                        domain="[('estado_entrada','=',False),('estado_salida','=',False)]"/>

                <!-- Agrupaciones -->
                <group expand="0" string="Agrupar por...">
                    <filter string="Empleado" name="group_empleado" context="{'group_by':'empleado_id'}"/>
                    <filter string="Fecha" name="group_fecha" context="{'group_by':'fecha'}"/>
                    <filter string="Día" name="group_day_id" context="{'group_by':'day_id'}"/>
                    <filter string="Estado Entrada" name="group_estado_entrada"
                            context="{'group_by':'estado_entrada'}"/>
                    <filter string="Estado Salida" name="group_estado_salida" context="{'group_by':'estado_salida'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Acción -->
    <record id="action_employee_attendance_calendar" model="ir.actions.act_window">
        <field name="name">Asistencias</field>
        <field name="res_model">employee.attendance.calendar</field>
        <field name="view_mode">tree</field>
        <field name="search_view_id" ref="view_employee_attendance_calendar_search"/>
        <field name="help" type="html">
            <p>Vista de asistencia de empleados contra calendario laboral.</p>
        </field>
        <field name="context">{'search_default_filtro_atrasos': 1,'search_default_filtro_anticipada':
            1,'search_default_filtro_incompletos': 1}
        </field>
    </record>

    <record id="action_employee_attendance_calendar_my" model="ir.actions.act_window">
        <field name="name">Asistencias</field>
        <field name="res_model">employee.attendance.calendar</field>
        <field name="view_mode">tree</field>
        <field name="search_view_id" ref="view_employee_attendance_calendar_search"/>
        <field name="help" type="html">
            <p>Vista de asistencia de empleados contra calendario laboral.</p>
        </field>
        <field name="context">{'only_user':True,'search_default_filtro_atrasos': 1,'search_default_filtro_anticipada':
            1,'search_default_filtro_incompletos': 1}
        </field>
    </record>
</odoo>
