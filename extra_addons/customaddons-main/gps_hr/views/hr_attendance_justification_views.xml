<odoo>
    <!-- Motivos -->
    <record id="view_hr_attendance_justification_reason_tree" model="ir.ui.view">
        <field name="name">hr.attendance.justification.reason.tree</field>
        <field name="model">hr.attendance.justification.reason</field>
        <field name="arch" type="xml">
            <tree string="Motivos de Justificación">
                <field name="nombre"/>
                <field name="descripcion"/>
                <field name="activo"/>
            </tree>
        </field>
    </record>

    <record id="view_hr_attendance_justification_reason_form" model="ir.ui.view">
        <field name="name">hr.attendance.justification.reason.form</field>
        <field name="model">hr.attendance.justification.reason</field>
        <field name="arch" type="xml">
            <form string="Motivo de Justificación">
                <sheet>
                    <group>
                        <field name="nombre"/>
                        <field name="descripcion"/>
                        <field name="activo"/>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Acción Servidor: Aprobar Seleccionados -->
    <record id="action_server_batch_aprobar_justification" model="ir.actions.server">
        <field name="name">Aprobar Seleccionados</field>
        <field name="model_id" ref="model_hr_attendance_justification"/>
        <field name="binding_model_id" ref="model_hr_attendance_justification"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
            records.action_batch_aprobar()
        </field>
    </record>

    <!-- Acción Servidor: Rechazar Seleccionados -->
    <record id="action_server_batch_rechazar_justification" model="ir.actions.server">
        <field name="name">Rechazar Seleccionados</field>
        <field name="model_id" ref="model_hr_attendance_justification"/>
        <field name="binding_model_id" ref="model_hr_attendance_justification"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
            records.action_batch_rechazar()
        </field>
    </record>


    <!-- Solicitudes (Tree) -->
    <record id="view_hr_attendance_justification_tree" model="ir.ui.view">
        <field name="name">hr.attendance.justification.tree</field>
        <field name="model">hr.attendance.justification</field>
        <field name="arch" type="xml">
            <tree string="Solicitudes de Justificación" create="false"
                  decoration-success="estado=='aprobado'"
                  decoration-danger="estado=='rechazado'"
                  decoration-info="estado in ('enviado','enviado_rrhh')">
                <field name="name"/>
                <field name="empleado_id"/>
                <field name="tipo"/>
                <field name="motivo_id"/>
                <field name="comentario"/>
                <!-- ✅ Estado con widget badge -->
                <field name="estado" widget="badge" decoration-success="estado=='aprobado'"
                       decoration-danger="estado=='rechazado'"
                       decoration-info="estado in ('enviado','enviado_rrhh')"
                       decoration-warning="estado=='borrador'"/>

                <!-- ✅ Botón Aprobar (solo RRHH) -->
                <button name="action_aprobar" type="object" icon="fa-check"
                        string="Aprobar"
                        attrs="{'invisible':[('estado','!=','enviado_rrhh')]}"/>

                <!-- ✅ Botón Rechazar (solo RRHH) -->
                <button name="action_rechazar" type="object" icon="fa-times"
                        string="Rechazar"
                        attrs="{'invisible':[('estado','!=','enviado_rrhh')]}"/>
            </tree>
        </field>
    </record>

    <!-- Solicitudes (Form) -->
    <record id="view_hr_attendance_justification_form" model="ir.ui.view">
        <field name="name">hr.attendance.justification.form</field>
        <field name="model">hr.attendance.justification</field>
        <field name="arch" type="xml">
            <form string="Solicitud de Justificación" edit="true" create="false">
                <header>
                    <!-- Enviar (Empleado) -->
                    <button name="action_enviar" type="object" string="Enviar"
                            attrs="{'invisible':[('estado','!=','borrador')]}"/>

                    <!-- Enviar a RRHH (Jefe directo o superior) -->
                    <button name="action_enviar_rrhh" type="object" string="Enviar a RRHH"
                            attrs="{'invisible':[('estado','!=','enviado')]}"
                            class="btn-primary"/>

                    <!-- Aprobar (RRHH) -->
                    <button name="action_aprobar" type="object" string="Aprobar"
                            attrs="{'invisible':[('estado','!=','enviado_rrhh')]}"
                            class="btn-primary"/>

                    <!-- Rechazar (RRHH) -->
                    <button name="action_rechazar" type="object" string="Rechazar"
                            attrs="{'invisible':[('estado','!=','enviado_rrhh')]}"
                            class="btn-primary"/>

                    <!-- Regresar a borrador (Jefe directo o RRHH) -->
                    <button name="action_draft" type="object" string="Regresar a Borrador"
                            attrs="{'invisible':[('estado','not in',('enviado','enviado_rrhh'))]}"
                            class="btn-primary"/>

                    <field name="estado" widget="statusbar"
                           statusbar_visible="borrador,enviado,enviado_rrhh,aprobado,rechazado"/>
                </header>

                <sheet>
                    <group>
                        <field name="empleado_id"/>
                        <field name="tipo" attrs="{'readonly':[('estado','!=','borrador')]}"/>
                        <field name="motivo_id" attrs="{'readonly':[('estado','!=','borrador')]}"/>
                        <field name="comentario" attrs="{'readonly':[('estado','!=','borrador')]}"/>
                        <field name="calendario_id" readonly="1"/>
                        <field name="jefe_directo_id" readonly="1"/>
                    </group>
                </sheet>

                <!-- ✅ Chatter agregado -->
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Search -->
    <record id="view_hr_attendance_justification_search" model="ir.ui.view">
        <field name="name">hr.attendance.justification.search</field>
        <field name="model">hr.attendance.justification</field>
        <field name="arch" type="xml">
            <search string="Solicitudes de Justificación">
                <field name="empleado_id"/>
                <field name="tipo"/>
                <field name="motivo_id"/>
                <field name="estado"/>

                <filter string="Mis Subordinados Directos"
                        name="filtro_subordinados_directos"
                        domain="[('empleado_id.parent_id.user_id','=',uid)]"/>

                <group expand="0" string="Agrupar por...">
                    <filter string="Empleado" name="group_empleado" context="{'group_by':'empleado_id'}"/>
                    <filter string="Tipo (Entrada/Salida)" name="group_tipo" context="{'group_by':'tipo'}"/>
                    <filter string="Motivo" name="group_motivo" context="{'group_by':'motivo_id'}"/>
                    <filter string="Estado" name="group_estado" context="{'group_by':'estado'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Wizard -->
    <record id="view_hr_attendance_justification_wizard_form" model="ir.ui.view">
        <field name="name">hr.attendance.justification.wizard.form</field>
        <field name="model">hr.attendance.justification.wizard</field>
        <field name="arch" type="xml">
            <form string="Justificar Asistencia">
                <group>
                    <field name="tipo"/>
                    <field name="motivo_id"/>
                    <field name="comentario"/>
                </group>
                <footer>
                    <button string="Confirmar" type="object" name="action_confirmar" class="btn-primary"/>
                    <button string="Cancelar" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Acciones -->
    <record id="action_hr_attendance_justification" model="ir.actions.act_window">
        <field name="name">Solicitudes de Justificación</field>
        <field name="res_model">hr.attendance.justification</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="view_hr_attendance_justification_search"/>
        <field name="context">{'only_user':True}</field>
        <field name="help" type="html">
            <p>Vista de todas las solicitudes de justificación.</p>
        </field>
    </record>

    <record id="action_hr_attendance_justification_my" model="ir.actions.act_window">
        <field name="name">Mis Solicitudes de Justificación</field>
        <field name="res_model">hr.attendance.justification</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="view_hr_attendance_justification_search"/>
        <field name="context">{'only_user':True}</field>
        <field name="help" type="html">
            <p>Vista de mis solicitudes y las de mis subordinados directos e indirectos.</p>
        </field>
    </record>
</odoo>
