<odoo>
    <!-- Motivos -->
    <record id="view_hr_attendance_justification_reason_tree" model="ir.ui.view">
        <field name="name">hr.attendance.justification.reason.tree</field>
        <field name="model">hr.attendance.justification.reason</field>
        <field name="arch" type="xml">
            <tree string="Motivos de Justificación">
                <field name="nombre"/>
                <field name="descripcion"/>
                <field name="activo"/>
            </tree>
        </field>
    </record>

    <record id="view_hr_attendance_justification_reason_form" model="ir.ui.view">
        <field name="name">hr.attendance.justification.reason.form</field>
        <field name="model">hr.attendance.justification.reason</field>
        <field name="arch" type="xml">
            <form string="Motivo de Justificación">
                <sheet>
                    <group>
                        <field name="nombre"/>
                        <field name="descripcion"/>
                        <field name="activo"/>
                    </group>
                </sheet>
                <!-- ✅ Chatter agregado -->
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Solicitudes -->
    <record id="view_hr_attendance_justification_tree" model="ir.ui.view">
        <field name="name">hr.attendance.justification.tree</field>
        <field name="model">hr.attendance.justification</field>
        <field name="arch" type="xml">
            <tree string="Solicitudes de Justificación" create="false"
                  decoration-success="estado=='aprobado'"
                  decoration-danger="estado=='rechazado'"
                  decoration-info="estado=='enviado'">
                <field name="name"/>
                <field name="empleado_id"/>
                <field name="tipo"/>
                <field name="motivo_id"/>
                <field name="comentario"/>
                <field name="estado"/>
            </tree>
        </field>
    </record>

    <record id="view_hr_attendance_justification_form" model="ir.ui.view">
        <field name="name">hr.attendance.justification.form</field>
        <field name="model">hr.attendance.justification</field>
        <field name="arch" type="xml">
            <form string="Solicitud de Justificación" edit="true" create="false">
                <header>
                    <button name="action_enviar" type="object" string="Enviar"
                            attrs="{'invisible':[('estado','!=','borrador')]}"/>
                    <button name="action_aprobar" type="object" string="Aprobar"
                            attrs="{'invisible':[('estado','!=','enviado')]}"/>
                    <button name="action_rechazar" type="object" string="Rechazar"
                            attrs="{'invisible':[('estado','!=','enviado')]}"/>
                    <button name="action_draft" type="object" string="Regresar a Borrador"
                            attrs="{'invisible':[('estado','!=','enviado')]}"
                            class="btn-secondary"/>
                    <field name="estado" widget="statusbar"
                           statusbar_visible="borrador,enviado,aprobado,rechazado"/>
                </header>
                <sheet>
                    <group>
                        <field name="empleado_id"/>
                        <field name="tipo" attrs="{'readonly':[('estado','!=','borrador')]}"/>
                        <field name="motivo_id" attrs="{'readonly':[('estado','!=','borrador')]}"/>
                        <field name="comentario" attrs="{'readonly':[('estado','!=','borrador')]}"/>
                        <field name="calendario_id" readonly="1"/>
                        <field name="jefe_directo_id" readonly="1"/>
                    </group>
                </sheet>
                <!-- ✅ Chatter agregado -->
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Wizard -->
    <record id="view_hr_attendance_justification_wizard_form" model="ir.ui.view">
        <field name="name">hr.attendance.justification.wizard.form</field>
        <field name="model">hr.attendance.justification.wizard</field>
        <field name="arch" type="xml">
            <form string="Justificar Asistencia">
                <group>
                    <field name="tipo"/>
                    <field name="motivo_id"/>
                    <field name="comentario"/>
                </group>
                <footer>
                    <button string="Confirmar" type="object" name="action_confirmar" class="btn-primary"/>
                    <button string="Cancelar" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- search view nuevo -->
    <record id="gps_hr_employee_attendance_raw_search" model="ir.ui.view">
        <field name="name">gps.hr.employee.attendance.raw.search</field>
        <field name="model">employee.attendance.raw</field>
        <field name="arch" type="xml">
            <search string="Marcaciones">
                <field name="date_time"/>
                <field name="employee_id"/>
                <field name="raw_user_id"/>
                <field name="biometric_id"/>

                <!-- Filtros -->
                <filter string="Manual" name="filter_manual" domain="[('biometric_id','=',False)]"/>
                <filter string="Automático" name="filter_automatico" domain="[('biometric_id','!=',False)]"/>

                <!-- Agrupar por -->
                <group expand="0" string="Agrupar por...">
                    <filter string="Empleado" name="group_employee" context="{'group_by':'employee_id'}"/>
                    <filter string="Fecha" name="group_fecha" context="{'group_by':'date_time'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- ACTUALIZAR acción existente en lugar de recrear -->
    <record id="zk_manager.action_employee_attendance_raw" model="ir.actions.act_window">
        <field name="search_view_id" ref="gps_hr_employee_attendance_raw_search"/>
    </record>

    <record id="zk_manager.action_employee_attendance_my_raw" model="ir.actions.act_window">
        <field name="search_view_id" ref="gps_hr_employee_attendance_raw_search"/>
    </record>

</odoo>
