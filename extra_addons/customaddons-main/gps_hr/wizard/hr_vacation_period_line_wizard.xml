<?xml version="1.0"?>
<odoo>
	<data>


<record id="view_hr_vacation_period_line_wizard_form" model="ir.ui.view">
    <field name="name">hr.vacation.period.line.wizard.form</field>
    <field name="model">hr.vacation.period.line.wizard</field>
    <field name="arch" type="xml">
        <form string="Agregar Solicitud de Pago">
            <group>
                <group>
                     <field name="period_id" readonly="1" force_save="1" colspan="2"
                     options="{'no_create':True,'no_open':True,'no_edit':True}"
                     />
                    <field name="date" required="1" colspan="2"/>
                     <field name="comments" required="1" placeholder="COMENTARIOS.." colspan="2"/>
                </group>
                 <group>
                       <field name="wage" required="1" colspan="2"/>
                     <field name="total_days" readonly="1" colspan="2"/>
                      <field name="days" required="1" colspan="2"/>

                        <field name="total" required="1" colspan="2"/>

                </group>




            </group>
            <footer>
                <button string="Agregar" type="object" name="action_add_payment_line" class="btn-primary"/>
                <button string="Cancelar" special="cancel"/>
            </footer>
        </form>
    </field>
</record>


<record id="action_open_hr_vacation_period_line_wizard" model="ir.actions.act_window">
    <field name="name">Solicitar Pago de Vacaciones</field>
    <field name="res_model">hr.vacation.period.line.wizard</field>
    <field name="view_mode">form</field>
    <field name="target">new</field>

    <field name="view_id" ref="view_hr_vacation_period_line_wizard_form"/>
    <field name="context">{'default_period_id': active_id,'default_type':'add'}</field>
</record>



        <record id="view_hr_vacation_period_line_payment_wizard_form" model="ir.ui.view">
    <field name="name">hr.vacation.period.line.payment.wizard.form</field>
    <field name="model">hr.vacation.period.line.wizard</field>
    <field name="arch" type="xml">
        <form string="Confirmar Pagos">
            <group>
                <group>
<field name="period_id" invisible="1" />
                    <field name="company_id"  readonly="1"
                           invisible="1"
                           options="{'no_create':True,'no_open':True,'no_edit':True}" force_save="1"/>
                    <field name="date" required="1"/>
                     <field name="only1by_employee" readonly="context.get('lock_for1_payment',False)" force_save="1"/>

                </group>
                 <group>
                        <field name="total" required="1" readonly="1" force_save="1"/>
                        <field name="comments" required="1"/>
                </group>




            </group>
            <newline/>
            <field name="period_line_ids" readonly="1" force_save="1" />
            <newline/>
            <footer>
                <button string="Pagar" type="object" name="action_create_movement" class="btn-primary"/>
                <button string="Cancelar" special="cancel"/>
            </footer>
        </form>
    </field>
</record>


        <record id="action_open_hr_vacation_period_line_payment_wizard" model="ir.actions.act_window">
    <field name="name">Pagar dias de Vacaciones</field>
    <field name="res_model">hr.vacation.period.line.wizard</field>
    <field name="view_mode">form</field>
    <field name="target">new</field>
            <field name="view_id" ref="view_hr_vacation_period_line_payment_wizard_form" />
    <field name="context">{'default_period_id':False,'default_type':'payment','lock_for1_payment':True,'default_period_line_ids':[active_id],'active_ids':[active_id],'active_id':active_id}</field>
</record>


        <record id="action_server_open_vacation_payment_wizard" model="ir.actions.server">
    <field name="name">Pagar Vacaciones</field>
    <field name="model_id" ref="model_hr_vacation_period_line"/>
    <field name="state">code</field>
    <field name="binding_model_id" ref="model_hr_vacation_period_line"/>
    <field name="code"># Validación: misma compañía
company_ids = records.mapped('company_id.id')
if len(set(company_ids)) > 1:
    raise UserError("Todos los registros deben pertenecer a la misma compañía para pagar las vacaciones.")
# Validación: estado confirmado
not_confirmed = records.filtered(lambda r: r.payment_state != 'confirm')
if not_confirmed:
    raise UserError("Todos los registros deben estar en estado 'Confirmado' para continuar.")

action = {
        'type': 'ir.actions.act_window',
        'name': 'Pagar Vacaciones',
        'res_model': 'hr.vacation.period.line.wizard',
        'view_mode': 'form',
        'target': 'new',
        'view_id':self.env.ref('gps_hr.view_hr_vacation_period_line_payment_wizard_form').id,
        'context': {
                'default_type': 'payment',
                'lock_for1_payment': False,
                'default_period_id':False,
                'default_period_line_ids': records.ids,
                'active_ids': records.ids,'active_id': records[0].id, 'default_company_id':company_ids[0]}
}
    </field>
</record>



    </data>

</odoo>