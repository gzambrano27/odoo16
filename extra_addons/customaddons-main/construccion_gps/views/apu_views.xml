<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Bill of Materials -->
        <record id="action_report_apu_apu" model="ir.actions.client">
            <field name="name">BoM Overview</field>
            <field name="tag">apu_apu_report</field>
            <field name="context" eval="{'model': 'report.mrp.report_bom_structure'}" />
        </record>

        <record id="action_export_apu_excel" model="ir.actions.server">
            <field name="name">Exportar APU a Excel</field>
            <field name="model_id" ref="model_apu_apu"/>
            <field name="binding_model_id" ref="model_apu_apu"/>
            <field name="state">code</field>
            <field name="code">
        action = records.export_excel_apu()
            </field>
        </record>

        <record id="apu_apu_byproduct_form_view" model="ir.ui.view">
            <field name="name">apu.apu.byproduct.form</field>
            <field name="model">apu.apu.byproduct</field>
            <field name="arch" type="xml">
                <form string="Byproduct">
                    <group>
                        <field name="allowed_operation_ids" invisible="1" />
                        <field name="company_id" />
                        <field name="product_id" />
                        <field name="product_uom_category_id" invisible="1" />
                        <label for="product_qty" />
                        <div class="o_row">
                            <field name="product_qty" />
                            <field name="product_uom_id" groups="uom.group_uom" />
                        </div>
                        <field name="operation_id" groups="mrp.group_mrp_routings"
                            options="{'no_quick_create':True,'no_create_edit':True}" />
                        <field name="possible_bom_product_template_attribute_value_ids" invisible="1" />
                        <field name="bom_product_template_attribute_value_ids" widget="many2many_tags"
                            options="{'no_create': True}" groups="product.group_product_variant" />
                    </group>
                </form>
            </field>
        </record>

        <record id="apu_apu_form_view" model="ir.ui.view">
            <field name="name">apu.apu.form</field>
            <field name="model">apu.apu</field>
            <field name="priority">100</field>
            <field name="arch" type="xml">
                <form string="Registro de APU">
                    <header>
                        <button name="export_excel" type="object" string="Exportar Plantilla" />
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="%(action_report_apu_apu)d" type="action" class="oe_stat_button" icon="fa-bars"
                                string="Overview" />
                        </div>
                        <widget name="web_ribbon" title="Archived" bg_color="bg-danger"
                            attrs="{'invisible': [('active', '=', True)]}" />
                        <!-- Sección para cargar el archivo Excel -->
                        <group col="12" class="mb-3"  groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente,!construccion_gps.group_apus_jefe">
                            <group colspan="6">
                                <field name="import_filename" invisible="1" />
                                <field name="import_file" filename="import_filename" widget="binary" />
                            </group>
                            <group colspan="6">
                                <button name="import_excel_apu" string="Importar" type="object" class="btn-primary" />
                            </group>
                        </group>
                        <group col="12">
                            <group colspan="6">
                                <field name="active" invisible="1" />
                                <field name="company_id" invisible="1" />
                                <field name="product_tmpl_id" context="{'default_detailed_type': 'product'}" />
                                <field name="product_uom_category_id" invisible="1" />
                                <field name="allow_operation_dependencies" invisible="1" />
                                <field name="product_id" groups="product.group_product_variant"
                                    context="{'default_detailed_type': 'product'}" />
                                <field name="product_id" groups="!product.group_product_variant" invisible="1" />
                                <label for="product_qty" string="Quantity" />
                                <div class="o_row">
                                    <field name="product_qty" />
                                    <field name="product_uom_id" options="{'no_open':True,'no_create':True}"
                                        groups="uom.group_uom" />
                                </div>
                                <field name="subcategoria_id" options="{'no_open':True,'no_create':True}"/>
                                <field name="tag_ids" widget="many2many_tags" placeholder="Agregar etiquetas" options="{'no_create': True, 'no_create_edit': True}"/>
                            </group>
                            <group colspan="6">
                                <field name="code" />
                                <field name="type" widget="radio" />
                                <field name="company_id" groups="base.group_multi_company"
                                    options="{'no_create': True, 'no_open': True}" />
                                <field name="cliente_id" widget="res_partner_many2one" />
                            </group>
                        </group>
                        <table class="table table-bordered" style="width:100%;" groups="construccion_gps.group_apus_usuario,construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente">
                            <thead class="text-center tw-bold">
                                <tr>
                                    <th>Descripción</th>
                                    <th>Porcentaje (%)</th>
                                    <th>Costo APU</th>
                                    <th>Precio APU</th>
                                    <th>Margen Bruto ($)</th>
                                    <th>Margen Bruto (%)</th>
                                </tr>
                            </thead>
                            <tbody class="text-center">
                                <tr>
                                    <td>Total Directo</td>
                                    <td></td>
                                    <td>
                                        <field name="total_costo_directo" readonly="1"/>
                                    </td>
                                    <td>
                                        <field name="total_precio" readonly="1"/>
                                    </td>
                                    <td>
                                        <field name="total_margen_bruto" readonly="1"/>
                                    </td>
                                    <td>
                                        <field name="total_porc_margen_bruto" widget="percentage"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Indirectos</td>
                                    <td>
                                        <field name="indirectos_porcentaje"/>
                                    </td>
                                    <td>
                                        <field name="indirectos_costo" force_save="1"/>
                                    </td>
                                    <td>
                                        <field name="indirectos_precio"/>
                                    </td>
                                    <td>
                                        <field name="indirectos_margen"/>
                                    </td>
                                    <td>
                                        <field name="indirectos_margen_porc" readonly="1" widget="percentage"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Utilidad</td>
                                    <td>
                                        <field name="utilidad_porcentaje"/>
                                    </td>
                                    <td>
                                        <field name="utilidad_costo" readonly="1"/>
                                    </td>
                                    <td>
                                        <field name="utilidad_precio" readonly="1"/>
                                    </td>
                                    <td>
                                        <field name="utilidad_margen" readonly="1"/>
                                    </td>
                                    <td>
                                        <field name="utilidad_margen_porc" readonly="1" widget="percentage"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Total APU</td>
                                    <td></td>
                                    <td>
                                        <field name="total_apu_costo" readonly="1"/>
                                    </td>
                                    <td>
                                        <field name="total_apu_precio" readonly="1"/>
                                    </td>
                                    <td>
                                        <field name="total_apu_margen" readonly="1"/>
                                    </td>
                                    <td>
                                        <field name="total_apu_margen_porc" readonly="1" widget="percentage"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <notebook>
                            <page string="Components" name="components">
                                <field name="line_ids" widget="one2many"
                                    context="{'default_parent_product_tmpl_id': product_tmpl_id, 'default_product_id': False, 'default_bom_id': id}">
                                    <tree string="Components">
                                        <field name="company_id" invisible="1" />
                                        <field name="sequence" widget="handle" />
                                        <field name="codigo_componente" />
                                        <field name="product_id" options="{'no_quick_create': True, 'no_create': True}"/>
                                        <field name="tipo_componente" />
                                        <field name="product_tmpl_id" invisible="1" />
                                        <!-- <button name="action_see_attachments" type="object" icon="fa-files-o" aria-label="Product Attachments" title="Product Attachments" class="float-end"/> -->
                                        <!-- <field name="attachments_count" class="text-start" string=" "/> -->
                                        <field name="product_uom_category_id" invisible="1" />
                                        <field name="parent_product_tmpl_id" invisible="1" />
                                        <field name="product_uom_id" string='Uni.'
                                            options="{'no_open':True,'no_create':True}" groups="uom.group_uom" />
                                        <field name="product_qty" />
                                        <field name="precio_unit"  groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                        <field name="precio_general" force_save="1"  groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                        <field name="cost"  groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                        <field name="subtotal" force_save="1"  groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                        <field name="margen_bruto" force_save="1" />
                                        <!-- <field name="porc_margen_bruto" force_save="1"/> -->
                                        <field name="semaforo_margen" invisible="1" />

                                        <field name="porc_margen_bruto" force_save="1" readonly="1"
                                            decoration-danger="semaforo_margen=='rojo'"
                                            decoration-success="semaforo_margen=='verde'"
                                            decoration-warning="semaforo_margen=='naranja'" widget="badge" />

                                        <field name="possible_bom_product_template_attribute_value_ids" invisible="1" />
                                        <field name="bom_product_template_attribute_value_ids" optional="hide"
                                            widget="many2many_tags" options="{'no_create': True}"
                                            attrs="{'column_invisible': [('parent.product_id', '!=', False)]}"
                                            groups="product.group_product_variant" />
                                        <field name="allowed_operation_ids" invisible="1" />
                                        <field name="operation_id" groups="mrp.group_mrp_routings" optional="hidden"
                                            attrs="{'column_invisible': [('parent.type','not in', ('normal', 'phantom'))]}"
                                            options="{'no_quick_create':True,'no_create_edit':True}" />
                                        <field name="manual_consumption_readonly" invisible="1" />
                                        <field name="manual_consumption" optional="hide" width="1.0"
                                            attrs="{'readonly': [('manual_consumption_readonly', '=', True)]}"
                                            force_save="1" />
                                    </tree>
                                    <form string="Línea de Actividades">
                                        <group col="12">
                                            <group colspan="12">
                                                <field name="company_id" invisible="1" />
                                                <field name="codigo_componente" />
                                                <field name="product_id" options="{'no_quick_create': True, 'no_create': True}"/>
                                                <field name="tipo_componente" />
                                                <field name="product_tmpl_id" invisible="1" />
                                                <!-- <button name="action_see_attachments" type="object" icon="fa-files-o" aria-label="Product Attachments" title="Product Attachments" class="float-end"/> -->
                                                <!-- <field name="attachments_count" class="text-start" string=" "/> -->
                                                <field name="product_uom_category_id" invisible="1" />
                                                <field name="parent_product_tmpl_id" invisible="1" />
                                                <field name="product_uom_id" string='Uni.'
                                                    options="{'no_open':True,'no_create':True}" groups="uom.group_uom" />
                                            </group>
                                        </group>
                                        <group col="12">
                                            <group colspan="6">
                                                <field name="product_qty" />
                                            </group>
                                        </group>
                                        <group col="12" groups="construccion_gps.group_apus_jefe,construccion_gps.group_apus_administrador,construccion_gps.group_apus_usuario">
                                            <group colspan="4">
                                                <field name="precio_unit" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                                <field name="precio_general" force_save="1" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                            </group>
                                            <group colspan="4">
                                                <field name="cost_compute" readonly="1" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                            </group>
                                            <group colspan="4">
                                                <field name="cost" readonly="0" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                                <field name="subtotal" force_save="1" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                                <field name="margen_bruto" force_save="1" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                            </group>
                                        </group>
                                        <group col="12" groups="construccion_gps.group_apus_gerente">
                                            <group colspan="4">
                                                <field name="precio_unit" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                                <field name="precio_general" force_save="1" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                            </group>
                                            <group colspan="4">
                                                <field name="cost_compute" readonly="1" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                            </group>
                                            <group colspan="4">
                                                <field name="cost" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                                <field name="subtotal" force_save="1" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                                <field name="margen_bruto" force_save="1" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                            </group>
                                        </group>
                                        <notebook>
                                            <page string="Actividades">
                                                <field name="line_tarea_ids">
                                                    <tree editable="bottom">
                                                        <field name="sequence" widget="handle" />
                                                        <field name="tarea_id" options="{'no_open':True,'no_create':True}"/>
                                                        <field name="tipo_actividad"/>
                                                        <field name="unidad"/>
                                                        <field name="cantidad"/>
                                                        <field name="costo" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                                        <field name="costo_hora_actividad" readonly="1" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                                        <field name="rendimiento"/>
                                                        <field name="costo_final_actividad" readonly="1" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                                                        <field name="company_id" invisible="1"/>
                                                    </tree>
                                                </field>
                                            </page>
                                        </notebook>
                                    </form>
                                </field>

                                <table class="table table-bordered"  groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente">
                                    <thead class="text-center tw-bold">
                                        <tr>
                                            <th>Tipo de Componente</th>
                                            <th>Precio</th>
                                            <th>Costo Directo</th>
                                            <th>Margen Bruto ($)</th>
                                            <th>Margen Bruto (%)</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-center">
                                        <tr>
                                            <td>Equipos</td>
                                            <td>
                                                <field name="total_equipos_precio" widget="monetary"
                                                    options="{'currency_field': 'currency_id'}" />
                                            </td>
                                            <td>
                                                <field name="total_equipos_costo_directo" widget="monetary"
                                                    options="{'currency_field': 'currency_id'}" />
                                            </td>
                                            <td>
                                                <field name="total_equipos_margen" widget="monetary"
                                                    options="{'currency_field': 'currency_id'}" />
                                            </td>
                                            <td>
                                                <field name="total_equipos_margen_porc" widget="percentage" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Mano de Obra</td>
                                            <td>
                                                <field name="total_mano_obra_precio" widget="monetary"
                                                    options="{'currency_field': 'currency_id'}" />
                                            </td>
                                            <td>
                                                <field name="total_mano_obra_costo_directo" widget="monetary"
                                                    options="{'currency_field': 'currency_id'}" />
                                            </td>
                                            <td>
                                                <field name="total_mano_obra_margen" widget="monetary"
                                                    options="{'currency_field': 'currency_id'}" />
                                            </td>
                                            <td>
                                                <field name="total_mano_obra_margen_porc" widget="percentage" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Materiales</td>
                                            <td>
                                                <field name="total_materiales_precio" widget="monetary"
                                                    options="{'currency_field': 'currency_id'}" />
                                            </td>
                                            <td>
                                                <field name="total_materiales_costo_directo" widget="monetary"
                                                    options="{'currency_field': 'currency_id'}" />
                                            </td>
                                            <td>
                                                <field name="total_materiales_margen" widget="monetary"
                                                    options="{'currency_field': 'currency_id'}" />
                                            </td>
                                            <td>
                                                <field name="total_materiales_margen_porc" widget="percentage" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Transporte</td>
                                            <td>
                                                <field name="total_transporte_precio" widget="monetary"
                                                    options="{'currency_field': 'currency_id'}" />
                                            </td>
                                            <td>
                                                <field name="total_transporte_costo_directo" widget="monetary"
                                                    options="{'currency_field': 'currency_id'}" />
                                            </td>
                                            <td>
                                                <field name="total_transporte_margen" widget="monetary"
                                                    options="{'currency_field': 'currency_id'}" />
                                            </td>
                                            <td>
                                                <field name="total_transporte_margen_porc" widget="percentage" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Total Directo</th>
                                            <th>
                                                <field name="total_precio" widget="monetary"
                                                    options="{'currency_field': 'currency_id'}" />
                                            </th>
                                            <th>
                                                <field name="total_costo_directo" widget="monetary"
                                                    options="{'currency_field': 'currency_id'}" />
                                            </th>
                                            <th>
                                                <field name="total_margen_bruto" widget="monetary"
                                                    options="{'currency_field': 'currency_id'}" />
                                            </th>
                                            <th>
                                                <field name="total_porc_margen_bruto" widget="percentage" />
                                            </th>
                                        </tr>
                                    </tbody>
                                </table>
                            </page>

                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" />
                        <field name="message_ids" colspan="4" nolabel="1" />
                    </div>

                </form>
            </field>
        </record>

        <record id="apu_apu_tree_view" model="ir.ui.view">
            <field name="name">apu.apu.tree</field>
            <field name="model">apu.apu</field>
            <field name="arch" type="xml">
                <tree string="Bill of Materials" sample="1" default_order="sequence, id">
                    <field name="sequence" widget="handle" />
                    <field name="code" string='Rubro' optional="show" />
                    <field name="subcategoria_id" string='Sub Categoria' optional="hide" />
                    <field name="tag_ids" optional="show" widget="many2many_tags"/>
                    <field name="product_id" groups="product.group_product_variant" optional="hide" />
                    <field name="product_uom_id" groups="uom.group_uom" optional="hide" string="Unit of Measure" />
                    <field name="active" invisible="1" />
                    <field name="product_tmpl_id" />
                    <field name="type" invisible='1' />
                    <field name="total_apu_costo" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                    <field name="total_apu_precio" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                    <field name="total_apu_margen" groups="construccion_gps.group_apus_usuario, construccion_gps.group_apus_jefe, construccion_gps.group_apus_gerente"/>
                    <field name="semaforo_margen" invisible='1' />
                    <field name="total_apu_margen_porc" invisible='1' />
                    <field name="total_apu_margen_porc_100" widget="badge" decoration-danger="semaforo_margen=='rojo'"
                        decoration-success="semaforo_margen=='verde'" decoration-warning="semaforo_margen=='naranja'" />
                    <!-- <field name="total_porc_margen_brutoc" widget="badge"  decoration-danger="semaforo_margen=='rojo'"
                                            decoration-success="semaforo_margen=='verde'"
                                            decoration-warning="semaforo_margen=='naranja'" /> -->
                    <field name="cliente_id" />
                    <field name="company_id" groups="base.group_multi_company" optional="show" />
                    <field name="product_qty" optional="hide" />
                    <field name="create_uid" widget="many2one_avatar_user" string="Creado por" optional="show"/>
                    <field name="create_date" string="Fecha de creación" optional="show"/>
                </tree>
            </field>
        </record>

        <record id="apu_apu_kanban_view" model="ir.ui.view">
            <field name="name">apu.apu.kanban</field>
            <field name="model">apu.apu</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile" sample="1">
                    <field name="product_tmpl_id" />
                    <field name="product_qty" />
                    <field name="product_uom_id" />
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_global_click">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings mt4">
                                        <strong class="o_kanban_record_title"><span class="mt4">
                                                <field name="product_tmpl_id" />
                                            </span></strong>
                                    </div>
                                    <span class="float-end badge rounded-pill">
                                        <t t-esc="record.product_qty.value" /> <small>
                                            <t t-esc="record.product_uom_id.value" />
                                        </small>
                                    </span>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="view_apu_apu_filter" model="ir.ui.view">
            <field name="name">apu.apu.select</field>
            <field name="model">apu.apu</field>
            <field name="arch" type="xml">
                <search string="Search Bill Of Material">
                    <field name="code" string="Bill of Materials"
                        filter_domain="['|', ('code', 'ilike', self), ('product_tmpl_id', 'ilike', self)]" />
                    <field name="product_tmpl_id" string="Product" />
                    <field name="line_ids" string="Component" />
                    <filter string="Manufacturing" name="normal" domain="[('type', '=', 'normal')]" />
                    <filter string="Kit" name="phantom" domain="[('type', '=', 'phantom')]" />
                    <separator />
                    <filter string="Archived" name="inactive" domain="[('active', '=', False)]" />
                    <group expand="0" string="Group By...">
                        <filter string="Product" name="product" domain="[]" context="{'group_by': 'product_tmpl_id'}" />
                        <filter string="Sub Categoria" name="subcategoria_id" domain="[]" context="{'group_by': 'subcategoria_id'}" />
                        <filter string='BoM Type' name="group_by_type" domain="[]" context="{'group_by' : 'type'}" />
                        <filter string='Unit of Measure' name="default_unit_of_measure" domain="[]"
                            context="{'group_by' : 'product_uom_id'}" />
                    </group>
                </search>
            </field>
        </record>

        <record id="apu_apu_form_action" model="ir.actions.act_window">
            <field name="name">Lista de APU's</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">apu.apu</field>
            <field name="domain">[]</field> <!-- force empty -->
            <field name="view_mode">tree,kanban,form</field>
            <field name="search_view_id" ref="view_apu_apu_filter" />
            <field name="context">{'default_company_id': allowed_company_ids[0]}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No bill of materials found. Let's create one!
                </p>
                <p>
                    Bills of materials allow you to define the list of required raw
                    materials used to make a finished product; through a manufacturing
                    order or a pack of products.
                </p>
            </field>
        </record>

        <!-- <menuitem id="menu_apu_apu_form_action"
            action="apu_apu_form_action"
            parent="menu_apu_apu"
            sequence="13"/> -->

        <!-- BOM Line -->
        <record id="apu_apu_line_view_form" model="ir.ui.view">
            <field name="name">apu.apu.line.view.form</field>
            <field name="model">apu.apu.line</field>
            <field name="arch" type="xml">
                <form string="Bill of Material line" create="0" edit="0">
                    <sheet>
                        <group>
                            <group string="Component">
                                <field name="product_id" />
                                <field name="parent_product_tmpl_id" invisible="1" />
                                <label for="product_qty" string="Quantity" />
                                <div class="o_row">
                                    <field name="product_qty" />
                                    <field name="product_uom_category_id" invisible="1" />
                                    <field name="product_uom_id" options="{'no_open':True,'no_create':True}"
                                        groups="uom.group_uom" />
                                </div>
                                <field name="possible_bom_product_template_attribute_value_ids" invisible="1" />
                                <field name="bom_product_template_attribute_value_ids" widget="many2many_tags"
                                    options="{'no_create': True}" groups="product.group_product_variant" />
                            </group>
                            <group string="Operation">
                                <field name="company_id" invisible="1" />
                                <field name="sequence" groups="base.group_no_one" />
                                <field name="allowed_operation_ids" invisible="1" />
                                <field name="operation_id" groups="mrp.group_mrp_routings" />
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- cambios de detalle de apus en vista de tipo arbol -->
        <record id="view_apu_line_tree_hierarchy" model="ir.ui.view">
            <field name="name">apu.apu.line.hierarchy</field>
            <field name="model">apu.apu.line</field>
            <field name="arch" type="xml">
                <tree string="Componentes del APU">
                    <field name="parent_id" invisible="1"/>
                    <field name="child_ids" invisible="1"/>
                    <field name="bom_id" invisible="1"/>

                    <field name="codigo_componente" string="Código"/>
                    <field name="product_id" string="Producto"/>
                    <field name="product_uom_id" string="UdM"/>
                    <field name="product_qty" string="Cantidad"/>
                    <field name="precio_unit" string="Precio/U"/>
                    <field name="precio_general" string="Precio Tot."/>
                    <field name="cost" string="Costo/U"/>
                    <field name="subtotal" string="Costo Tot."/>
                    <field name="tipo_componente" string="Tipo"/>
                </tree>
            </field>
        </record>
        <!-- fin llamado a arbol -->
        <record id="template_open_bom" model="ir.actions.act_window">
            <field name="context">{'default_product_tmpl_id': active_id}</field>
            <field name="name">Lista de APU's</field>
            <field name="res_model">apu.apu</field>
            <field name="domain">['|', ('product_tmpl_id', '=', active_id), ('byproduct_ids.product_id.product_tmpl_id',
                '=', active_id)]</field>
        </record>

        <record id="product_open_bom" model="ir.actions.act_window">
            <field name="context">{'default_product_id': active_id}</field>
            <field name="name">APU's</field>
            <field name="res_model">apu.apu</field>
            <field name="domain">[]</field> <!-- Force empty -->
        </record>

        <record id="action_apu_list" model="ir.actions.act_window">
            <field name="name">Lista de APU</field>
            <field name="res_model">apu.apu</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('product_tmpl_id', '=', active_id)]</field>
            <field name="context">{'default_product_tmpl_id': active_id}</field>
            <field name="target">current</field>
        </record>

    </data>
</odoo>